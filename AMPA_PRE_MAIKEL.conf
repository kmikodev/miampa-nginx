#proxy_cache_path /var/www/cache2 levels=1:2 keys_zone=my_cache2:10m max_size=10g inactive=60m use_temp_path=off;
#proxy_cache_key "$scheme$request_method$host$request_uri";


server {
    server_name ampamarywardbcn-dev2.miampa.com ampaagaudi-dev2.miampa.com apimagbc-dev2.miampa.com joanot-dev2.miampa.com dominicosoviedo-dev2.miampa.com apimalurgell-dev2.miampa.com afasantlluisbosch-dev2.miampa.com apimacanraspalls-dev2.miampa.com iesbetxiampa-dev2.miampa.com ampalagiralda-dev2.miampa.com ampacein-dev2.miampa.com ampasafaesc-dev2.miampa.com ampalagosazules-dev2.miampa.com ampavaldebebas-distefano-dev2.miampa.com somosescuela-dev2.miampa.com ampalaermita-dev2.miampa.com afapegaso-dev2.miampa.com ampalaestrella-dev2.miampa.com ampalasnieves-dev2.miampa.com ampalegazpi-dev2.miampa.com ampaescolatarragona-dev2.miampa.com apimasabodega-dev2.miampa.com ampatorrefarrera-dev2.miampa.com ampamddlledo-dev2.miampa.com ampasantjosep-dev2.miampa.com pilarbayona-dev2.miampa.com ampamddlledo-dev2.miampa.com ampaalandalus2000-dev2.miampa.com tucci-dev2.miampa.com ampaasuncion-dev2.miampa.com luisvivesampa-dev2.miampa.com ampasagradafamilia-dev2.miampa.com ampaiescarlosiiimadrid-dev2.miampa.com ampasantoangel-dev2.miampa.com apimasajoveria-dev2.miampa.com amptasoncaliu-dev2.miampa.com codapa-dev2.miampa.com  fapace-dev2.miampa.com ampaieslasmarinas-dev2.miampa.com  demoeduteca-dev2.miampa.com ampademo1-dev2.miampa.com ampademo2-dev2.miampa.com ampalosolivos-dev2.miampa.com amypasanvicentehuesca-dev2.miampa.com ampadetales-dev2.miampa.com empty-dev2.miampa.com ampademo4-dev2.miampa.com apacic-dev2.miampa.com ampaochando-dev2.miampa.com ampaceipcalderon-dev2.miampa.com apapioxii-dev2.miampa.com ampacepzurbaran-dev2.miampa.com ceipgonzaloberceo-dev2.miampa.com ampagarcilasodelavega-dev2.miampa.com ampapetra-dev2.miampa.com ampavirgendelosdolores-dev2.miampa.com miralcamp-dev2.miampa.com ampalorcaboadilla-dev2.miampa.com ampaangelinaabad-dev2.miampa.com ampapradotalavera-dev2.miampa.com ampaportitxol-dev2.miampa.com ampaceipreginaviolant-dev2.miampa.com ampajosesoriano-dev2.miampa.com ampamadresacramento-dev2.miampa.com ampapius12-dev2.miampa.com ampasantsebastia-dev2.miampa.com test-dev2.miampa.com ampaescolaelmorell-dev2.miampa.com anasotoampa-dev2.miampa.com amipanacaragol-dev2.miampa.com educo-dev2.miampa.com educoampa1-dev2.miampa.com educoampa2-dev2.miampa.com ampamestral-dev2.miampa.com ampavicentebenitez-dev2.miampa.com ampabarrancodelastorres-dev2.miampa.com amipasolivera-dev2.miampa.com ampapresentacion-dev2.miampa.com ampateresines-dev2.miampa.com ampaserraihunter-dev2.miampa.com ampasanmiguel-dev2.miampa.com ampadansavalencia-dev2.miampa.com ampajtous-dev2.miampa.com altas-dev2.miampa.com ampaceusevilla-dev2.miampa.com ampasalesianosdeusto-dev2.miampa.com santvicentferrersagunt-dev2.miampa.com template-dev2.miampa.com ampalaspruebas-dev2.miampa.com ampalosalamos-dev2.miampa.com amypalosamigos-dev2.miampa.com amypatecnologicomatias-dev2.miampa.com ampalosbetunesdelmar-dev2.miampa.com ampaarcoiris-dev2.miampa.com julito-dev2.miampa.com soses-dev2.miampa.com ampaelcarmen-dev2.miampa.com ampacolegiosanpedropascual-dev2.miampa.com apvillarrealcf-dev2.miampa.com ampademo3-dev2.miampa.com ampacolegioartica-dev2.miampa.com ampa8deabril-dev2.miampa.com ampaplateroyyo-dev2.miampa.com ampaaltozanosanjacinto-dev2.miampa.com ampaelcoto-dev2.miampa.com comercial-dev2.miampa.com ampabaltasarrull-dev2.miampa.com ampainselspallaresos-dev2.miampa.com ampajuanesteve-dev2.miampa.com ampaseveroochoa-dev2.miampa.com ampaelcarmen-dev2.miampa.com  ampaceiptorreblanca-dev2.miampa.com ampalluisguarner-dev2.miampa.com ampaloseriales-dev2.miampa.com igorrekogurasoelkartea-dev2.miampa.com amparteagabeitia-dev2.miampa.com ampasalvadorvinuesa-dev2.miampa.com ampasanfelipeneri-dev2.miampa.com ampatrilemaelpilar-dev2.miampa.com ampazaragueta-dev2.miampa.com ampamariamoliner-dev2.miampa.com ampaelquinon-dev2.miampa.com ampamgg-dev2.miampa.com apamadrerafols-dev2.miampa.com apatagore-dev2.miampa.com ampaleopoldocalvosotelo-dev2.miampa.com ampaieslahoyadebunyol-dev2.miampa.com admin-dev2.miampa.com elatzeta-dev2.miampa.com ampacarmelitestgn-dev2.miampa.com ampatijoco-dev2.miampa.com ampasantjordimollet-dev2.miampa.com ampatrilemaelpilar-dev2.miampa.com ampagarcilasomadrid-dev2.miampa.com;
    client_max_body_size 20M;

    location / {
      ssi on;
      proxy_set_header Accept-Encoding "";
      proxy_pass http://170.253.43.123:4200/;
    }

    location /ampas/ {
        proxy_pass https://replace-dev2.miampa.com/;
    }


    location ~* /api/language(.*)$ {
        proxy_pass http://170.253.43.123:4000/i18n/language$1?$query_string;
    }

    location = /apple-app-site-association {
      proxy_redirect     off;
      proxy_set_header   Host $host;
      proxy_set_header   X-Real-IP $remote_addr;
      proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_set_header   X-Forwarded-Host $server_name;
        proxy_pass http://170.253.43.123:4000/utilities/iosdepplink;
    }

    location = /.well-known/apple-app-site-association {
      proxy_redirect     off;
      proxy_set_header   Host $host;
      proxy_set_header   X-Real-IP $remote_addr;
      proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_set_header   X-Forwarded-Host $server_name;
        proxy_pass http://170.253.43.123:4000/utilities/iosdepplink;
    }

    location ~* /api/translation(.*)$ {
      proxy_redirect     off;
      proxy_set_header   Host $host;
      proxy_set_header   X-Real-IP $remote_addr;
      proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_set_header   X-Forwarded-Host $server_name;
        proxy_pass http://170.253.43.123:4000/i18n/translation$1?$query_string;
    }
    location /pre/ {
      proxy_redirect     off;
      proxy_set_header   Host $host;
      proxy_set_header   X-Real-IP $remote_addr;
      proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_set_header   X-Forwarded-Host $server_name;
        proxy_pass http://170.253.43.123:4000/;
    }

    location /api/ {
      proxy_redirect     off;
      proxy_set_header   Host $host;
      proxy_set_header   X-Real-IP $remote_addr;
      proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_set_header   X-Forwarded-Host $server_name;
        proxy_pass http://170.253.43.123:4000/api/;
    }
  listen 443 ssl http2;
  listen [::]:443 ssl http2;
  ssl_session_cache shared:SSL:10m;

  add_header Strict-Transport-Security "max-age=31536000; includeSubDomains";
  add_header X-Frame-Options DENY always;
  add_header X-Content-Type-Options nosniff always;
  add_header X-Xss-Protection "1; mode=block" always;
  ssl_stapling on;
  ssl_stapling_verify on;
  resolver 1.1.1.1 1.0.0.1 [2606:4700:4700::1111] [2606:4700:4700::1001] valid=300s; # Cloudflare
  resolver_timeout 5s;
  ssl_certificate /etc/letsencrypt/live/miampa.com/fullchain.pem; # managed by Certbot
  ssl_certificate_key /etc/letsencrypt/live/miampa.com/privkey.pem; # managed by Certbot
  include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot


}



server {
    server_name api-dev2.miampa.com;

    location / {
    
    	proxy_set_header Host $host;
    	proxy_set_header X-Real-IP $remote_addr;
        proxy_pass http://170.253.43.123:4000/api/;
    }
    listen 443 ssl http2;
    listen [::]:443 ssl http2;
    ssl_session_cache shared:SSL:10m;
    
    add_header Strict-Transport-Security "max-age=31536000; includeSubDomains";
    add_header X-Frame-Options DENY always;
    add_header X-Content-Type-Options nosniff always;
    add_header X-Xss-Protection "1; mode=block" always;
    ssl_stapling on;
    ssl_stapling_verify on;
    resolver 1.1.1.1 1.0.0.1 [2606:4700:4700::1111] [2606:4700:4700::1001] valid=300s; # Cloudflare
    resolver_timeout 5s;
    ssl_certificate /etc/letsencrypt/live/miampa.com/fullchain.pem; # managed by Certbot
    ssl_certificate_key /etc/letsencrypt/live/miampa.com/privkey.pem; # managed by Certbot
    include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot
    
}


server {
    server_name api2-dev2.miampa.com;

    location / {
    
    	proxy_set_header Host $host;
    	proxy_set_header X-Real-IP $remote_addr;
        proxy_pass http://170.253.43.123:4000/;
    }
    listen 443 ssl http2;
    listen [::]:443 ssl http2;
    ssl_session_cache shared:SSL:10m;
    
    add_header Strict-Transport-Security "max-age=31536000; includeSubDomains";
    add_header X-Frame-Options DENY always;
    add_header X-Content-Type-Options nosniff always;
    add_header X-Xss-Protection "1; mode=block" always;
    ssl_stapling on;
    ssl_stapling_verify on;
    resolver 1.1.1.1 1.0.0.1 [2606:4700:4700::1111] [2606:4700:4700::1001] valid=300s; # Cloudflare
    resolver_timeout 5s;
    ssl_certificate /etc/letsencrypt/live/miampa.com/fullchain.pem; # managed by Certbot
    ssl_certificate_key /etc/letsencrypt/live/miampa.com/privkey.pem; # managed by Certbot
    include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot
    
}


