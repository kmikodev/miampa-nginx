#proxy_cache_path /var/www/cache2 levels=1:2 keys_zone=my_cache2:10m max_size=10g inactive=60m use_temp_path=off;
#proxy_cache_key "$scheme$request_method$host$request_uri";

server {
        server_name ampamarywardbcn-dev3.miampa.com ampaagaudi-dev3.miampa.com apimagbc-dev3.miampa.com joanot-dev3.miampa.com dominicosoviedo-dev3.miampa.com apimalurgell-dev3.miampa.com afasantlluisbosch-dev3.miampa.com apimacanraspalls-dev3.miampa.com iesbetxiampa-dev3.miampa.com ampalagiralda-dev3.miampa.com ampacein-dev3.miampa.com ampasafaesc-dev3.miampa.com ampalagosazules-dev3.miampa.com ampavaldebebas-distefano-dev3.miampa.com somosescuela-dev3.miampa.com ampalaermita-dev3.miampa.com afapegaso-dev3.miampa.com ampalaestrella-dev3.miampa.com ampalasnieves-dev3.miampa.com ampalegazpi-dev3.miampa.com ampaescolatarragona-dev3.miampa.com apimasabodega-dev3.miampa.com ampatorrefarrera-dev3.miampa.com ampamddlledo-dev3.miampa.com ampasantjosep-dev3.miampa.com pilarbayona-dev3.miampa.com ampamddlledo-dev3.miampa.com ampaalandalus2000-dev3.miampa.com tucci-dev3.miampa.com ampaasuncion-dev3.miampa.com luisvivesampa-dev3.miampa.com ampasagradafamilia-dev3.miampa.com ampaiescarlosiiimadrid-dev3.miampa.com ampasantoangel-dev3.miampa.com apimasajoveria-dev3.miampa.com amptasoncaliu-dev3.miampa.com codapa-dev3.miampa.com  fapace-dev3.miampa.com ampaieslasmarinas-dev3.miampa.com  demoeduteca-dev3.miampa.com ampademo1-dev3.miampa.com ampademo2-dev3.miampa.com ampalosolivos-dev3.miampa.com amypasanvicentehuesca-dev3.miampa.com ampadetales-dev3.miampa.com empty-dev3.miampa.com ampademo4-dev3.miampa.com apacic-dev3.miampa.com ampaochando-dev3.miampa.com ampaceipcalderon-dev3.miampa.com apapioxii-dev3.miampa.com ampacepzurbaran-dev3.miampa.com ceipgonzaloberceo-dev3.miampa.com ampagarcilasodelavega-dev3.miampa.com ampapetra-dev3.miampa.com ampavirgendelosdolores-dev3.miampa.com miralcamp-dev3.miampa.com ampalorcaboadilla-dev3.miampa.com ampaangelinaabad-dev3.miampa.com ampapradotalavera-dev3.miampa.com ampaportitxol-dev3.miampa.com ampaceipreginaviolant-dev3.miampa.com ampajosesoriano-dev3.miampa.com ampamadresacramento-dev3.miampa.com ampapius12-dev3.miampa.com ampasantsebastia-dev3.miampa.com test-dev3.miampa.com ampaescolaelmorell-dev3.miampa.com anasotoampa-dev3.miampa.com amipanacaragol-dev3.miampa.com educo-dev3.miampa.com educoampa1-dev3.miampa.com educoampa2-dev3.miampa.com ampamestral-dev3.miampa.com ampavicentebenitez-dev3.miampa.com ampabarrancodelastorres-dev3.miampa.com amipasolivera-dev3.miampa.com ampapresentacion-dev3.miampa.com ampateresines-dev3.miampa.com ampaserraihunter-dev3.miampa.com ampasanmiguel-dev3.miampa.com ampadansavalencia-dev3.miampa.com ampajtous-dev3.miampa.com altas-dev3.miampa.com ampaceusevilla-dev3.miampa.com ampasalesianosdeusto-dev3.miampa.com santvicentferrersagunt-dev3.miampa.com template-dev3.miampa.com ampalaspruebas-dev3.miampa.com ampalosalamos-dev3.miampa.com amypalosamigos-dev3.miampa.com amypatecnologicomatias-dev3.miampa.com ampalosbetunesdelmar-dev3.miampa.com ampaarcoiris-dev3.miampa.com julito-dev3.miampa.com soses-dev3.miampa.com ampaelcarmen-dev3.miampa.com ampacolegiosanpedropascual-dev3.miampa.com apvillarrealcf-dev3.miampa.com ampademo3-dev3.miampa.com ampacolegioartica-dev3.miampa.com ampa8deabril-dev3.miampa.com ampaplateroyyo-dev3.miampa.com ampaaltozanosanjacinto-dev3.miampa.com ampaelcoto-dev3.miampa.com comercial-dev3.miampa.com ampabaltasarrull-dev3.miampa.com ampainselspallaresos-dev3.miampa.com ampajuanesteve-dev3.miampa.com ampaseveroochoa-dev3.miampa.com ampaelcarmen-dev3.miampa.com  ampaceiptorreblanca-dev3.miampa.com ampalluisguarner-dev3.miampa.com ampaloseriales-dev3.miampa.com igorrekogurasoelkartea-dev3.miampa.com amparteagabeitia-dev3.miampa.com ampasalvadorvinuesa-dev3.miampa.com ampasanfelipeneri-dev3.miampa.com ampatrilemaelpilar-dev3.miampa.com ampazaragueta-dev3.miampa.com ampamariamoliner-dev3.miampa.com ampaelquinon-dev3.miampa.com ampamgg-dev3.miampa.com apamadrerafols-dev3.miampa.com apatagore-dev3.miampa.com ampaleopoldocalvosotelo-dev3.miampa.com ampaieslahoyadebunyol-dev3.miampa.com admin-dev3.miampa.com elatzeta-dev3.miampa.com ampacarmelitestgn-dev3.miampa.com ampatijoco-dev3.miampa.com ampasantjordimollet-dev3.miampa.com ampatrilemaelpilar-dev3.miampa.com ampagarcilasomadrid-dev3.miampa.com;
    client_max_body_size 20M;

    location / {
      ssi on;
      proxy_set_header Accept-Encoding "";
      proxy_pass http://170.253.33.201:4200/;
    }

    location /ampas/ {
        proxy_pass https://replace.miampa.com/;
    }


    location ~* /api/language(.*)$ {
        proxy_pass http://170.253.33.201:4000/i18n/language$1?$query_string;
    }

 location = /apple-app-site-association {
      proxy_redirect     off;
      proxy_set_header   Host $host;
      proxy_set_header   X-Real-IP $remote_addr;
      proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_set_header   X-Forwarded-Host $server_name;
        proxy_pass http://85.56.198.41:4000/utilities/iosdepplink;
    }

    location = /.well-known/apple-app-site-association {
      proxy_redirect     off;
      proxy_set_header   Host $host;
      proxy_set_header   X-Real-IP $remote_addr;
      proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_set_header   X-Forwarded-Host $server_name;
        proxy_pass http://85.56.198.41:4000/utilities/iosdepplink;
    }

    location ~* /api/translation(.*)$ {
      proxy_redirect     off;
      proxy_set_header   Host $host;
      proxy_set_header   X-Real-IP $remote_addr;
      proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_set_header   X-Forwarded-Host $server_name;
        proxy_pass http://170.253.33.201:4000/i18n/translation$1?$query_string;
    }
    location /pre/ {
      proxy_redirect     off;
      proxy_set_header   Host $host;
      proxy_set_header   X-Real-IP $remote_addr;
      proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_set_header   X-Forwarded-Host $server_name;
        proxy_pass http://170.253.33.201:4000/;
    }

    location /api/ {
      proxy_redirect     off;
      proxy_set_header   Host $host;
      proxy_set_header   X-Real-IP $remote_addr;
      proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_set_header   X-Forwarded-Host $server_name;
        proxy_pass http://170.253.33.201:4000/api/;
    }
  listen 443 ssl http2;
  listen [::]:443 ssl http2;
  ssl_session_cache shared:SSL:10m;

  add_header Strict-Transport-Security "max-age=31536000; includeSubDomains";
  add_header X-Frame-Options DENY always;
  add_header X-Content-Type-Options nosniff always;
  add_header X-Xss-Protection "1; mode=block" always;
  ssl_stapling on;
  ssl_stapling_verify on;
  resolver 1.1.1.1 1.0.0.1 [2606:4700:4700::1111] [2606:4700:4700::1001] valid=300s; # Cloudflare
  resolver_timeout 5s;
  ssl_certificate /etc/letsencrypt/live/miampa.com/fullchain.pem; # managed by Certbot
  ssl_certificate_key /etc/letsencrypt/live/miampa.com/privkey.pem; # managed by Certbot
  include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot


}



server {
    server_name api-dev3.miampa.com;

    location / {
    
    	proxy_set_header Host $host;
    	proxy_set_header X-Real-IP $remote_addr;
        proxy_pass http://170.253.33.201:4000/api/;
    }
    listen 443 ssl http2;
    listen [::]:443 ssl http2;
    ssl_session_cache shared:SSL:10m;
    
    add_header Strict-Transport-Security "max-age=31536000; includeSubDomains";
    add_header X-Frame-Options DENY always;
    add_header X-Content-Type-Options nosniff always;
    add_header X-Xss-Protection "1; mode=block" always;
    ssl_stapling on;
    ssl_stapling_verify on;
    resolver 1.1.1.1 1.0.0.1 [2606:4700:4700::1111] [2606:4700:4700::1001] valid=300s; # Cloudflare
    resolver_timeout 5s;
    ssl_certificate /etc/letsencrypt/live/miampa.com/fullchain.pem; # managed by Certbot
    ssl_certificate_key /etc/letsencrypt/live/miampa.com/privkey.pem; # managed by Certbot
    include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot
    
}


server {
    server_name api2-dev3.miampa.com;

    location / {
    
    	proxy_set_header Host $host;
    	proxy_set_header X-Real-IP $remote_addr;
        proxy_pass http://170.253.33.201:4000/;
    }
    listen 443 ssl http2;
    listen [::]:443 ssl http2;
    ssl_session_cache shared:SSL:10m;
    
    add_header Strict-Transport-Security "max-age=31536000; includeSubDomains";
    add_header X-Frame-Options DENY always;
    add_header X-Content-Type-Options nosniff always;
    add_header X-Xss-Protection "1; mode=block" always;
    ssl_stapling on;
    ssl_stapling_verify on;
    resolver 1.1.1.1 1.0.0.1 [2606:4700:4700::1111] [2606:4700:4700::1001] valid=300s; # Cloudflare
    resolver_timeout 5s;
    ssl_certificate /etc/letsencrypt/live/miampa.com/fullchain.pem; # managed by Certbot
    ssl_certificate_key /etc/letsencrypt/live/miampa.com/privkey.pem; # managed by Certbot
    include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot
    
}


